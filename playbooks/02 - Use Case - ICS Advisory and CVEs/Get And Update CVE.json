{
    "@type": "Workflow",
    "triggerLimit": null,
    "name": "Get And Update CVE",
    "aliasName": null,
    "tag": null,
    "description": "Playbook fetches latest report of CVE from NIST-NVD and update CVE record.",
    "isActive": true,
    "debug": false,
    "singleRecordExecution": false,
    "remoteExecutableFlag": false,
    "parameters": [
        "CVERecord"
    ],
    "synchronous": false,
    "collection": "\/api\/3\/workflow_collections\/d84beded-f595-4e73-90c4-c32992183749",
    "versions": [],
    "triggerStep": "\/api\/3\/workflow_steps\/c4ec48ec-7113-4fb7-9608-bd503b4c2bf9",
    "steps": [
        {
            "@type": "WorkflowStep",
            "name": "Get CVE Details by ID",
            "description": null,
            "arguments": {
                "name": "NIST National Vulnerability Database",
                "config": "09666536-d2b4-4833-adf3-5df2d57b8e2b",
                "params": {
                    "cveId": "{{vars.record['cVEID']}}"
                },
                "version": "1.0.1",
                "connector": "nist-nvd",
                "operation": "get_specific_cve_details",
                "ignore_errors": false,
                "operationTitle": "Get Specific CVE ID Details",
                "pickFromTenant": false,
                "step_variables": {
                    "CVEData": "{{vars.steps.Get_CVE_Details_by_ID.data.vulnerabilities}}"
                }
            },
            "status": null,
            "top": "300",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/0bfed618-0316-11e7-93ae-92361f002671",
            "group": null,
            "uuid": "35ecf89d-278b-4d1b-9dbe-a2e984fa2ab0"
        },
        {
            "@type": "WorkflowStep",
            "name": "Configuration",
            "description": null,
            "arguments": {
                "record": "{{vars.input.params.CVERecord}}",
                "severityMap": "{'NONE': {{'Severity'| picklist('Minimal') }}, 'LOW': {{'Severity'| picklist('Low') }}, 'MEDIUM': {{'Severity'| picklist('Medium') }}, 'HIGH': {{'Severity'| picklist('High') }}, 'CRITICAL': {{'Severity'| picklist('Critical') }}}"
            },
            "status": null,
            "top": "165",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "4126b601-fd04-4d00-81bc-1c60a6c332b3"
        },
        {
            "@type": "WorkflowStep",
            "name": "Output",
            "description": null,
            "arguments": {
                "results": "{% set output = ({\"uuid\":vars.record['uuid'], \"cVEId\":vars.record['cVEID']}) %}{% if vars.CVEData | length > 0 %}{% set _ = output.update({\"status\": \"Found\"}) %}{% else %}{% set _ = output.update({\"status\": \"Not Found\"}) %}{% endif %}{{output}}"
            },
            "status": null,
            "top": "705",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "4dc7573d-0861-44f4-b254-f5f040f89a24"
        },
        {
            "@type": "WorkflowStep",
            "name": "Update CVE",
            "description": null,
            "arguments": {
                "when": "{{vars.CVEData | length > 0}}",
                "resource": {
                    "cWEID": "{% if vars.CVEData[0].cve.get(\"weaknesses\", \"\") != \"\" %}{% set cwe = vars.CVEData[0].cve['weaknesses'] | json_query(\"[*][description][][][value][]\") | unique %}{{cwe | join(', ')}}{% endif %}",
                    "__link": {
                        "recordTags": "{% if (vars.CVEData[0].cve.keys() | string | regex_findall('cisa')) %}{{\"KEV\"}}{% endif %}"
                    },
                    "action": "{{vars.CVEData[0].cve.cisaRequiredAction}}",
                    "cVEURL": "https:\/\/nvd.nist.gov\/vuln\/detail\/{{vars.CVEData[0].cve['id']}}",
                    "cVSSv2": "{% if  (vars.CVEData[0].cve.metrics.keys() | string | regex_findall('cvssMetricV2'))[0] %} \n<table id=\"table\" style=\"float: left; margin-right: 18%;\"> \n{% if vars.CVEData[0].cve['metrics']['cvssMetricV2'][0]['cvssData']['baseScore'] %} \n<tr>\n    <td>Base Score<\/td>\n    <td>\n      <span data-uib-tooltip=\"Soft delete will flag comments for deletion instead of permanently deleting them. Soft deleted comments will not show up in search results.\" data-tooltip-append-to-body=\"true\"><span style=color:{{\"Severity\" | picklist(vars.CVEData[0].cve['metrics']['cvssMetricV2'][0]['baseSeverity'], \"color\")}}>{{vars.CVEData[0].cve['metrics']['cvssMetricV2'][0]['cvssData']['baseScore']}} <\/span><\/span>\n    <\/td>\n  <\/tr>\n{% endif %}\n{% if vars.CVEData[0].cve['metrics']['cvssMetricV2'][0]['exploitabilityScore'] %} <tr>\n    <td>Exploitability<\/td>\n    <td>{{vars.CVEData[0].cve['metrics']['cvssMetricV2'][0]['exploitabilityScore']}}<\/td>\n  <\/tr> {% endif %} \n{% if vars.CVEData[0].cve['metrics']['cvssMetricV2'][0]['impactScore'] %} <tr>\n    <td>Impact<\/td>\n    <td>{{vars.CVEData[0].cve['metrics']['cvssMetricV2'][0]['impactScore']}}<\/td>\n  <\/tr> {% endif %}\n{% if vars.CVEData[0].cve['metrics']['cvssMetricV2'][0]['cvssData']['vectorString'] %}\n<tr>\n    <td>Vector<\/td>\n    <td>{{vars.CVEData[0].cve['metrics']['cvssMetricV2'][0]['cvssData']['vectorString']}}<\/td>\n  <\/tr>\n{% endif %} \n<\/table>\n<table id=\"table2\" style=\"float: left; margin-right: 23%;\">\n{% if vars.CVEData[0].cve['metrics']['cvssMetricV2'][0]['cvssData']['accessVector'] %} <tr>\n    <td>Access Vector<\/td>\n    <td>{{vars.CVEData[0].cve['metrics']['cvssMetricV2'][0]['cvssData']['accessVector']}}\n    <\/td>\n  <\/tr> \n{% endif %}\n{% if vars.CVEData[0].cve['metrics']['cvssMetricV2'][0]['cvssData']['accessComplexity'] %} <tr>\n    <td>Access Complexity<\/td>\n    <td>{{vars.CVEData[0].cve['metrics']['cvssMetricV2'][0]['cvssData']['accessComplexity']}}\n    <\/td>\n  <\/tr> {% endif %}\n{% if vars.CVEData[0].cve['metrics']['cvssMetricV2'][0]['cvssData']['authentication'] %} <tr>\n    <td>Authentication<\/td>\n    <td>{{vars.CVEData[0].cve['metrics']['cvssMetricV2'][0]['cvssData']['authentication']}}\n    <\/td>\n  <\/tr> {% endif %}\n<\/table>\n<table id=\"table3\" style=\"float: left;\">\n{% if vars.CVEData[0].cve['metrics']['cvssMetricV2'][0]['cvssData']['confidentialityImpact'] %} <tr>\n    <td>Confidentiality Impact<\/td>\n    <td>{{vars.CVEData[0].cve['metrics']['cvssMetricV2'][0]['cvssData']['confidentialityImpact']}}\n    <\/td>\n  <\/tr> {% endif %} \n{% if vars.CVEData[0].cve['metrics']['cvssMetricV2'][0]['cvssData']['integrityImpact'] %} <tr>\n    <td>Integrity Impact<\/td>\n    <td>{{vars.CVEData[0].cve['metrics']['cvssMetricV2'][0]['cvssData']['integrityImpact']}}\n    <\/td>\n  <\/tr> {% endif %} {% if vars.CVEData[0].cve['metrics']['cvssMetricV2'][0]['cvssData']['availabilityImpact'] %} <tr>\n    <td>Availability Impact<\/td>\n    <td>{{vars.CVEData[0].cve['metrics']['cvssMetricV2'][0]['cvssData']['availabilityImpact']}}\n    <\/td>\n  <\/tr> {% endif %} <\/table> {% else %}null{% endif %}",
                    "cVSSv3": "{% if  (vars.CVEData[0].cve.metrics.keys() | string | regex_findall('cvssMetricV3[0-9]'))[0] %} {% set  version = vars.CVEData[0].cve.metrics.keys() | max %} <table id=\"table\" style=\"float: left; margin-right: 11%;\"> {% if vars.CVEData[0].cve.metrics[version][0]['cvssData']['baseScore'] %} <tr>\n    <td>Base Score<\/td>\n    <td>\n      <span data-tomark-pass=\"\" style=color:{{\"Severity\" | picklist(vars.CVEData[0].cve.metrics.get(version)[0].cvssData.baseSeverity, \"color\")}}>{{vars.CVEData[0].cve.metrics[version][0]['cvssData']['baseScore']}} <\/span>\n    <\/td>\n  <\/tr> {% endif %}{% if vars.CVEData[0].cve.metrics[version][0]['exploitabilityScore']%} <tr>\n    <td>Exploitability<\/td>\n    <td>{{vars.CVEData[0].cve.metrics[version][0]['exploitabilityScore']}}<\/td>\n  <\/tr> {% endif %} {% if vars.CVEData[0].cve.metrics[version][0]['impactScore']%} <tr>\n    <td>Impact<\/td>\n    <td>{{vars.CVEData[0].cve.metrics[version][0]['impactScore']}}<\/td>\n  <\/tr> {% endif %} {% if vars.CVEData[0].cve.metrics[version][0]['cvssData']['vectorString'] %} <tr>\n    <td>Vector<\/td>\n    <td>{{vars.CVEData[0].cve.metrics[version][0]['cvssData']['vectorString']}}<\/td>\n  <\/tr> {% endif %}  <\/table>\n<table id=\"table2\" style=\"float: left; margin-right: 23%;\"> {% if vars.CVEData[0].cve.metrics[version][0]['cvssData']['attackVector'] %} <tr>\n    <td>Attack Vector<\/td>\n    <td>{{vars.CVEData[0].cve.metrics[version][0]['cvssData']['attackVector']}}<\/td>\n  <\/tr> {% endif %} {% if vars.CVEData[0].cve.metrics[version][0]['cvssData']['attackComplexity'] %} <tr>\n    <td>Attack Complexity<\/td>\n    <td>{{vars.CVEData[0].cve.metrics[version][0]['cvssData']['attackComplexity']}}<\/td>\n  <\/tr> {% endif %} {% if vars.CVEData[0].cve.metrics[version][0]['cvssData']['privilegesRequired'] %} <tr>\n    <td>Privileges Required<\/td>\n    <td>{{vars.CVEData[0].cve.metrics[version][0]['cvssData']['privilegesRequired']}} <\/td>\n  <\/tr> {% endif %} {% if vars.CVEData[0].cve.metrics[version][0]['cvssData']['userInteraction'] %} <tr>\n    <td>User Interaction<\/td>\n    <td>{{vars.CVEData[0].cve.metrics[version][0]['cvssData']['userInteraction']}}<\/td>\n  <\/tr> {% endif %} <\/table>\n<table id=\"table3\" style=\"float: left;\"> {% if vars.CVEData[0].cve.metrics[version][0]['cvssData']['confidentialityImpact'] %} <tr>\n    <td>Confidentiality Impact<\/td>\n    <td>{{vars.CVEData[0].cve.metrics[version][0]['cvssData']['confidentialityImpact']}}<\/td>\n  <\/tr> {% endif %} {% if vars.CVEData[0].cve.metrics[version][0]['cvssData']['integrityImpact'] %} <tr>\n    <td>Integrity Impact<\/td>\n    <td>{{vars.CVEData[0].cve.metrics[version][0]['cvssData']['integrityImpact']}}<\/td>\n  <\/tr> {% endif %} {% if vars.CVEData[0].cve.metrics[version][0]['cvssData']['availabilityImpact'] %} <tr>\n    <td>Availability Impact<\/td>\n    <td>{{vars.CVEData[0].cve.metrics[version][0]['cvssData']['availabilityImpact']}}<\/td>\n  <\/tr> {% endif %} {% if vars.CVEData[0].cve.metrics[version][0]['cvssData']['scope'] %} <tr>\n    <td>Scope<\/td>\n    <td>{{vars.CVEData[0].cve.metrics[version][0]['cvssData']['scope']}}<\/td>\n  <\/tr> {% endif %} <\/table>{% else %}null{% endif %}",
                    "severity": "{{vars.severityValue}}",
                    "reference": "{% if vars.CVEData[0].cve['references'] %}\n| Hyperlink | Tags | Source |\n| --- | --- | --- |{% for item in vars.CVEData[0].cve['references'] %}\n| <a href=\"{{item.url}}\">{{item.url}}<\/a> | {% for data in item.tags %}<span class=\"badge badge-pill badge-danger\" style=\"background: #22A6AF; color: #fff;\">{{data}}<\/span> {% endfor %} | {{item.source}} |{% endfor %}{% else %}null{% endif %}",
                    "cPEsDetail": "{% if vars.CVEData[0].cve.configurations[0]['nodes'][0]['cpeMatch'] %}\n| CPE Name | Is Vulnerable | Match Id |\n| --- | --- | --- |{% for item in vars.CVEData[0].cve.configurations[0]['nodes'][0]['cpeMatch'] %}\n| {{item.criteria}} | {{item.vulnerable}} | {{item.matchCriteriaId}} |{% endfor %}{% else %}null{% endif %}",
                    "sourceData": "{{vars.CVEData[0].cve | toJSON }}",
                    "description": "{{(vars.CVEData[0].cve.descriptions  | json_query(\"[?lang == 'en'].value\"))[0] }}",
                    "kEVTagSource": "\/api\/3\/picklists\/b5492d79-fe49-43ab-9786-f8e60fc12204",
                    "publishedDate": "{{arrow.get(vars.CVEData[0].cve['published']).int_timestamp}}",
                    "isInKEVCatalog": "{% if (vars.CVEData[0].cve.keys() | string | regex_findall('cisa')) %}{{\"YesNoInput\" | picklist(\"Yes\", \"@id\")}}{% else %}{{\"YesNoInput\" | picklist(\"No\", \"@id\")}}{% endif %}",
                    "lastModifiedOn": "{{arrow.get(vars.CVEData[0].cve['lastModified']).int_timestamp}}",
                    "evaluatorImpact": "{% if vars.CVEData[0].cve['evaluatorImpact'] %}{{vars.CVEData[0].cve['evaluatorImpact']}}{% else %}null{% endif %}",
                    "responseDueDate": "{% if vars.CVEData[0].cve.cisaActionDue %}{{arrow.get(vars.CVEData[0].cve.cisaActionDue).int_timestamp}}{% endif %}",
                    "identifierSource": "{{vars.CVEData[0].cve.sourceIdentifier}}",
                    "vendorStatements": "{% if 'vendorComments' in vars.CVEData[0].cve %}\n[Vendor Statements](https:\/\/nvd.nist.gov\/vuln\/vendor-comments)\n\n{% for item in vars.CVEData[0].cve['vendorComments'] %}\n<p><h5>{{item.organization}} ({{item.lastModified.split('T')[0] }}) <\/h5>&emsp;{{item.comment}}<\/p>\n{% endfor %}{% else %}null{% endif %}\n",
                    "evaluatorSolution": "{% if vars.CVEData[0].cve['evaluatorImpact'] %}{{vars.CVEData[0].cve['evaluatorImpact']}}{% else %}null{% endif %}",
                    "vulnerabilityName": "{{vars.CVEData[0].cve.cisaVulnerabilityName}}",
                    "vulnerabilityStatus": "{{\"CVEVulnerabilityStatus\" | picklist(vars.CVEData[0].cve['vulnStatus'], \"@id\")}}",
                    "dateAddedToKEVCatalog": "{% if vars.CVEData[0].cve.cisaExploitAdd %}{{arrow.get(vars.CVEData[0].cve.cisaExploitAdd).int_timestamp}}{% endif %}"
                },
                "operation": "Append",
                "collection": "{{vars.record['@id']}}",
                "__recommend": [],
                "collectionType": "\/api\/3\/c_v_es",
                "fieldOperation": {
                    "recordTags": "Append"
                },
                "step_variables": []
            },
            "status": null,
            "top": "570",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/b593663d-7d13-40ce-a3a3-96dece928722",
            "group": null,
            "uuid": "7cdae58e-6005-453b-8fb2-569de37f0b57"
        },
        {
            "@type": "WorkflowStep",
            "name": "Start",
            "description": null,
            "arguments": {
                "step_variables": {
                    "input": {
                        "params": []
                    }
                }
            },
            "status": null,
            "top": "30",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/b348f017-9a94-471f-87f8-ce88b6a7ad62",
            "group": null,
            "uuid": "c4ec48ec-7113-4fb7-9608-bd503b4c2bf9"
        },
        {
            "@type": "WorkflowStep",
            "name": "Set Severity Value",
            "description": null,
            "arguments": {
                "severityValue": "{% if  (vars.CVEData[0].cve.metrics.keys() | string | regex_findall('cvssMetricV3[0-9]'))[0] %}{% set version = vars.CVEData[0].cve.metrics.keys() | max %}{% set _value = vars.CVEData[0].cve.metrics.get(version)[0].cvssData.baseSeverity %}{% elif  (vars.CVEData[0].cve.metrics.keys() | string | regex_findall('cvssMetricV2'))[0] %}{% set _value = vars.CVEData[0].cve['metrics']['cvssMetricV2'][0]['baseSeverity'] %}{% endif %}{{_value | resolveRange(vars.severityMap)}}"
            },
            "status": null,
            "top": "435",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "d9170e58-34dc-4743-b048-ad63d87cea4c"
        }
    ],
    "routes": [
        {
            "@type": "WorkflowRoute",
            "name": "Get CVE Details by ID -> Set Severity Value",
            "targetStep": "\/api\/3\/workflow_steps\/d9170e58-34dc-4743-b048-ad63d87cea4c",
            "sourceStep": "\/api\/3\/workflow_steps\/35ecf89d-278b-4d1b-9dbe-a2e984fa2ab0",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "984007a5-d2ed-4bfd-bc04-6f06a6074f28"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Start -> Configuration",
            "targetStep": "\/api\/3\/workflow_steps\/4126b601-fd04-4d00-81bc-1c60a6c332b3",
            "sourceStep": "\/api\/3\/workflow_steps\/c4ec48ec-7113-4fb7-9608-bd503b4c2bf9",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "6f5e5de7-0385-4d63-ad1b-d633c26cdb31"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Configuration -> Get CVE by ID",
            "targetStep": "\/api\/3\/workflow_steps\/35ecf89d-278b-4d1b-9dbe-a2e984fa2ab0",
            "sourceStep": "\/api\/3\/workflow_steps\/4126b601-fd04-4d00-81bc-1c60a6c332b3",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "829f2d64-f5ae-4864-a361-3891affefead"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Update CVE -> Output",
            "targetStep": "\/api\/3\/workflow_steps\/4dc7573d-0861-44f4-b254-f5f040f89a24",
            "sourceStep": "\/api\/3\/workflow_steps\/7cdae58e-6005-453b-8fb2-569de37f0b57",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "f07f7e27-67c2-48f3-9db1-8b3a2702badd"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Set Severity Value -> Update CVE",
            "targetStep": "\/api\/3\/workflow_steps\/7cdae58e-6005-453b-8fb2-569de37f0b57",
            "sourceStep": "\/api\/3\/workflow_steps\/d9170e58-34dc-4743-b048-ad63d87cea4c",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "fe5c2c34-2555-4e38-8dc8-456ab9cbc88f"
        }
    ],
    "groups": [],
    "priority": "\/api\/3\/picklists\/2b563c61-ae2c-41c0-a85a-c9709585e3f2",
    "uuid": "74d37cd4-263a-4685-844d-7d73a4b803dd",
    "owners": [],
    "isPrivate": false,
    "deletedAt": null,
    "recordTags": [
        "IT OT",
        "NIST NVD",
        "CVE",
        "Referenced"
    ]
}