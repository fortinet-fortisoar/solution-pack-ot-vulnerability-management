{
    "@type": "Workflow",
    "triggerLimit": null,
    "name": "> Check KEV Alert SLA",
    "aliasName": null,
    "tag": null,
    "description": "Playbook checks for KEV Alert to send reminder or not.",
    "isActive": true,
    "debug": false,
    "singleRecordExecution": false,
    "remoteExecutableFlag": false,
    "parameters": [
        "kevAlertData"
    ],
    "synchronous": false,
    "collection": "\/api\/3\/workflow_collections\/db7036e6-4e35-4479-beea-d7fefc73ab68",
    "versions": [],
    "triggerStep": "\/api\/3\/workflow_steps\/19d64448-0779-4b42-834a-456b2ce75ebf",
    "steps": [
        {
            "@type": "WorkflowStep",
            "name": "Configuration",
            "description": null,
            "arguments": {
                "cveData": "{{vars.input.params.kevAlertData.c_v_es[0]}}",
                "icsData": "{{vars.input.params.kevAlertData.i_c_s_advisories[0]}}",
                "kevAlertData": "{{vars.input.params.kevAlertData}}"
            },
            "status": null,
            "top": "165",
            "left": "300",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "fa4cf4f6-24e1-47dc-b0ff-2bd2733ce937"
        },
        {
            "@type": "WorkflowStep",
            "name": "Generate KEV Alert Summary Report",
            "description": null,
            "arguments": {
                "arguments": [],
                "apply_async": false,
                "step_variables": [],
                "pass_parent_env": true,
                "pass_input_record": false,
                "workflowReference": "\/api\/3\/workflows\/d721e52d-fae6-4605-98b9-fe329fc58a84"
            },
            "status": null,
            "top": "570",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "a2af9734-0c84-4905-85d5-be92379b2b0c"
        },
        {
            "@type": "WorkflowStep",
            "name": "Get Remaining Time",
            "description": null,
            "arguments": {
                "SLARemainingDays": "{{(arrow.get(vars.kevAlertData['responseDueDate']).format(\"YYYY-MM-DD HH:mm:ss\") | to_datetime - arrow.utcnow().format(\"YYYY-MM-DD HH:mm:ss\") | to_datetime).days}}"
            },
            "status": null,
            "top": "300",
            "left": "300",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "c55b8c7d-5b67-43df-972a-f28998fb029a"
        },

        {
            "@type": "WorkflowStep",
            "name": "No Operation",
            "description": null,
            "arguments": {
                "params": [],
                "version": "3.2.4",
                "connector": "cyops_utilities",
                "operation": "no_op",
                "operationTitle": "Utils: No Operation",
                "step_variables": []
            },
            "status": null,
            "top": "570",
            "left": "475",
            "stepType": "\/api\/3\/workflow_step_types\/0109f35d-090b-4a2b-bd8a-94cbc3508562",
            "group": null,
            "uuid": "6959a0a6-f849-48c0-b9a5-e5fbe1f22f4b"
        },
        {
            "@type": "WorkflowStep",
            "name": "Send Variables",
            "description": null,
            "arguments": {
                "data": "{% set data = {} %}{% set _ = data.update({'kevAlertIRI':vars.kevAlertData['@id'], 'icsAdvisoryIRI':vars.icsData['@id'], 'cveIRI':vars.cveData['@id'], 'reportFileIRI':vars.steps.Generate_KEV_Alert_Summary_Report['report']['file'][\"@id\"], 'remaniningDays': vars.SLARemainingDays, 'assetCount': (vars.kevAlertData.assets | length)}) %}{{data}}"
            },
            "status": null,
            "top": "840",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "5634d987-6685-4f48-86a8-7dcc194e2589"
        },
        {
            "@type": "WorkflowStep",
            "name": "Start",
            "description": null,
            "arguments": {
                "step_variables": {
                    "input": {
                        "params": []
                    }
                }
            },
            "status": null,
            "top": "30",
            "left": "300",
            "stepType": "\/api\/3\/workflow_step_types\/b348f017-9a94-471f-87f8-ce88b6a7ad62",
            "group": null,
            "uuid": "19d64448-0779-4b42-834a-456b2ce75ebf"
        },
        {
            "@type": "WorkflowStep",
            "name": "Send Reminder or SLA Breached",
            "description": null,
            "arguments": {
                "conditions": [
                    {
                        "option": "Yes",
                        "step_iri": "\/api\/3\/workflow_steps\/a2af9734-0c84-4905-85d5-be92379b2b0c",
                        "condition": "{{ vars.SLARemainingDays in vars.reminderDayList }}",
                        "step_name": "Generate KEV Alert Summary Report"
                    },
                    {
                        "option": "No",
                        "default": true,
                        "step_iri": "\/api\/3\/workflow_steps\/6959a0a6-f849-48c0-b9a5-e5fbe1f22f4b",
                        "step_name": "No Operation"
                    },
                    {
                        "option": "Yes",
                        "step_iri": "\/api\/3\/workflow_steps\/a2af9734-0c84-4905-85d5-be92379b2b0c",
                        "condition": "{{ vars.SLARemainingDays < 0 }}",
                        "step_name": "Generate KEV Alert Summary Report"
                    }
                ],
                "step_variables": []
            },
            "status": null,
            "top": "435",
            "left": "300",
            "stepType": "\/api\/3\/workflow_step_types\/12254cf5-5db7-4b1a-8cb1-3af081924b28",
            "group": null,
            "uuid": "e35f7441-b93f-43d7-8d1c-9ad0f6f2ef7c"
        },
        {
            "@type": "WorkflowStep",
            "name": "Add Comment if SLA Breach",
            "description": null,
            "arguments": {
                "when": "{{vars.SLARemainingDays < 0}}",
                "resource": {
                    "type": "\/api\/3\/picklists\/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                    "people": [],
                    "content": "<p><span style=\"text-decoration: underline;\"><em><strong>BOD 22-01 Reminder<\/strong><\/em><\/span><\/p>\n<p>SLA got breached as of {{vars.SLARemainingDays * -1}} days ago.<\/p>\n<p>Response Due Date was: {{arrow.get(vars.kevAlertData['responseDueDate']).format(\"YYYY-MM-DD HH:mm:ss\")}}<\/p>\n<p>&nbsp;<\/p>",
                    "__replace": "",
                    "kEVAlerts": "{{vars.input.params.kevAlertData[\"@id\"]}}",
                    "isImportant": false,
                    "peopleUpdated": false
                },
                "operation": "Overwrite",
                "collection": "\/api\/3\/comments",
                "__recommend": [],
                "fieldOperation": {
                    "recordTags": "Overwrite"
                },
                "step_variables": []
            },
            "status": null,
            "top": "705",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/2597053c-e718-44b4-8394-4d40fe26d357",
            "group": null,
            "uuid": "1bebbb6f-c362-4db9-8544-15d55df26342"
        }
    ],
    "routes": [
        {
            "@type": "WorkflowRoute",
            "name": "Add Comment if SLA Breach -> Send Variables",
            "targetStep": "\/api\/3\/workflow_steps\/5634d987-6685-4f48-86a8-7dcc194e2589",
            "sourceStep": "\/api\/3\/workflow_steps\/1bebbb6f-c362-4db9-8544-15d55df26342",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "5988b46a-ef2a-440b-87f4-9042c822df2d"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Configuration -> Set Notification Time",
            "targetStep": "\/api\/3\/workflow_steps\/c55b8c7d-5b67-43df-972a-f28998fb029a",
            "sourceStep": "\/api\/3\/workflow_steps\/fa4cf4f6-24e1-47dc-b0ff-2bd2733ce937",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "93482c9e-9ff0-4c6e-a68c-c0a38da7a40b"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Generate KEV Alert Summary Report -> Add Comment if SLA Breach",
            "targetStep": "\/api\/3\/workflow_steps\/1bebbb6f-c362-4db9-8544-15d55df26342",
            "sourceStep": "\/api\/3\/workflow_steps\/a2af9734-0c84-4905-85d5-be92379b2b0c",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "5398dd70-29f5-4343-8ea8-ba54d646317c"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Send Reminder or SLA Breached -> Generate KEV Alert Summary Reportv",
            "targetStep": "\/api\/3\/workflow_steps\/a2af9734-0c84-4905-85d5-be92379b2b0c",
            "sourceStep": "\/api\/3\/workflow_steps\/e35f7441-b93f-43d7-8d1c-9ad0f6f2ef7c",
            "label": "Yes",
            "isExecuted": false,
            "group": null,
            "uuid": "de69b3a3-7ea5-4d7d-b019-7806da036b96"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Send Reminder or SLA Breached -> No Operation",
            "targetStep": "\/api\/3\/workflow_steps\/6959a0a6-f849-48c0-b9a5-e5fbe1f22f4b",
            "sourceStep": "\/api\/3\/workflow_steps\/e35f7441-b93f-43d7-8d1c-9ad0f6f2ef7c",
            "label": "No",
            "isExecuted": false,
            "group": null,
            "uuid": "231b8201-d658-45fc-b512-94a6080539de"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Set Notification Time -> Send Reminder or SLA Breached",
            "targetStep": "\/api\/3\/workflow_steps\/e35f7441-b93f-43d7-8d1c-9ad0f6f2ef7c",
            "sourceStep": "\/api\/3\/workflow_steps\/c55b8c7d-5b67-43df-972a-f28998fb029a",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "52b175d1-5f0f-48a0-9b55-a5bf85cc1f5c"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Start -> Configuration",
            "targetStep": "\/api\/3\/workflow_steps\/fa4cf4f6-24e1-47dc-b0ff-2bd2733ce937",
            "sourceStep": "\/api\/3\/workflow_steps\/19d64448-0779-4b42-834a-456b2ce75ebf",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "d3af450a-f47d-4cac-beb6-9bb9d2be2e7c"
        }
    ],
    "groups": [],
    "priority": "\/api\/3\/picklists\/2b563c61-ae2c-41c0-a85a-c9709585e3f2",
    "uuid": "576852fe-23c2-4490-bb50-b03335a6eab8",
    "owners": [],
    "isPrivate": false,
    "deletedAt": null,
    "recordTags": [
        "CVE",
        "ICS Advisory",
        "IT OT",
        "KEV Alert",
        "Referenced",
        "Report",
        "Scheduled"
    ]
}